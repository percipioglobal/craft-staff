{"version":3,"file":"payruns.b88d6b1d.js","sources":["../../../../../buildchain/src/vue/molecules/listitems/listitem--payrun.vue","../../../../../buildchain/src/vue/payrun/PayRunList.vue","../../../../../buildchain/src/js/payruns.ts"],"sourcesContent":["<script setup lang=\"ts\">\n    import { format } from '~/js/composables/useCurrencyFormat'\n\n    const currentYear = window.location.href.split('/').pop()\n\n    const props = defineProps({\n        payrunData: Object,\n    })\n    \n</script>\n\n<template>\n    <a \n        v-for=\"payrun in payrunData\" :key=\"payrun.id\"\n        :href=\"`/admin/staff-management/pay-runs/${payrun.employerId}/${currentYear}/${payrun.id}`\" \n        :title=\"`Go to pay run ${payrun.period}/${payrun.taxYear}`\" \n        class=\"grid grid-cols-4 lg:grid-cols-7 border-b border-solid border-gray-200 no-underline hover:bg-gray-200\" \n    >\n        <div class=\"flex items-center whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-indigo-800 sm:pl-6\">\n            <span :class=\"[\n                'rounded-full w-5 h-5 fond-bold flex items-center justify-center mb-0',\n                payrun.state == 'Open' ? 'border-2 border-solid border-emrald-500 text-emerald-500': '',\n                payrun.state == 'Closed' ? 'border-2 border-solid border-green-500 text-white bg-emerald-500': '',\n                payrun.state == 'Finalised' ? 'border-2 border-solid border-green-500 text-white bg-emerald-500': ''\n            ]\">{{ payrun.period }}</span>\n        </div>\n        <div class=\"hide lg:flex lg:items-center whitespace-nowrap px-3 py-4 text-sm text-gray-500\">{{ payrun.employeeCount }}</div>\n        <div class=\"hide lg:flex lg:items-center col-span-2 whitespace-nowrap px-3 py-4 text-sm text-gray-500\">{{ payrun.startDate }} - {{ payrun.endDate }}</div>\n        <div class=\"hide lg:flex lg:items-center whitespace-nowrap px-3 py-4 text-sm text-gray-500\">Â£ {{ format(payrun.totals.totalCost) }}</div>\n        <div class=\"flex items-center whitespace-nowrap px-3 py-4 text-sm text-gray-500\">{{ payrun.paymentDate }}</div>\n        <div class=\"flex items-center whitespace-nowrap px-3 py-4 text-sm text-gray-500\">{{ payrun.dateSynced }}</div>\n    </a>\n</template>","<script setup lang=\"ts\">\n    import { reactive } from 'vue'\n\n    import { useQuery } from '@vue/apollo-composable'\n\n    import { fetchPayRuns } from '~/js/composables/useAxiosClient'\n    import { usePayRunStore } from '~/stores/payrun'\n    import { PAYRUNS } from '~/graphql/payrun.ts'\n\n    import PayRunList from '~/vue/molecules/listitems/listitem--payrun.vue'\n    import LoadingList from '~/vue/molecules/listitems/listitem--loading.vue'\n    import StatusSynced from '~/vue/molecules/status/status--synced.vue'\n\n    const variables = reactive({ \n        taxYear: window.location.href.split('/').pop(),\n        employerId: window.location.href.split('/').at(-2)\n    })\n\n    const { result, loading, refetch } = useQuery(\n        PAYRUNS, \n        variables, \n        { pollInterval: 5000 }\n    )\n\n    const store = usePayRunStore()\n\n    const getLatestSync = (payruns: any) => {\n\n        if (!payruns) {\n            return 'unknown'\n        }\n\n        const sorted = payruns.map(pr => pr.dateSynced).sort((a, b) => a < b)\n        return sorted.length > 0 ? sorted[0] : 'unknown'\n\n    }\n\n    const updateYear = (selectedYear: string) => {\n\n        const baseUrl = new URL(window.location.href)\n        const path = baseUrl.pathname.split('/')\n        path.pop()\n        baseUrl.pathname = path.join('/') + '/' + selectedYear\n        window.history.pushState({}, '', baseUrl)\n\n        variables.taxYear = selectedYear\n    }\n\n</script>\n\n<template>\n\n    <div class=\"md:flex items-start\" v-if=\"result\">\n        <div class=\"flex-grow pr-4\" style=\"margin-bottom:0\">\n            <div class=\"flex items-center\">\n                <a href=\"/admin/staff-management/pay-runs\" :title=\"`Back to ${result.payruns[0]?.employer}`\" class=\"inline-flex no-underline items-center px-2.5 py-1.5 rounded-full text-sm text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\" style=\"margin-bottom:0\">&larr;</a>\n                <h1 class=\"ml-1 text-xl font-semibold text-gray-900\">{{result.payruns[0]?.employer}}</h1>\n            </div>\n            <p class=\"mt-2 text-sm text-gray-700\">The table below shows payrun overviews for {{ result.payruns[0]?.employer }}. If a payrun has recently been setup in Staffology but does not yet appear below, click the Fetch&nbsp;Pay&nbsp;Runs button to update. </p>\n        </div>\n        <div class=\"mt-4 md:mt-0 flex\" style=\"margin-bottom:0\">\n            <StatusSynced :date=\"getLatestSync(result.payruns)\" />\n            <button \n                @click=\"fetchPayRuns(variables?.employerId, variables?.taxYear)\"\n                :disabled=\"store.loadingFetched\" \n                class=\"cursor-pointer inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 disabled:bg-indigo-400 disabled:cursor-not-allowed px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto\" \n                style=\"margin-bottom:0\"\n            >\n                <span>Refresh Pay Runs</span>\n                <svg v-if=\"store.loadingFetched\" class=\"animate-spin ml-1 h-3 w-3 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" style=\"margin-bottom:0\">\n                    <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n                    <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                </svg>\n            </button>\n        </div>\n    </div>\n\n    <div class=\"mt-8 ml-auto grid grid-cols-4\" v-if=\"result\">\n        <div class=\"col-start-4 flex justify-end\">\n            <span class=\"mb-1 mr-2 font-bold\">Choose a payroll year:</span>\n            <select class=\"py-1 px-1 rounded-md bg-gray-100 border-2 border-indigo-600 text-right\" @change=\"updateYear($event?.target?.value)\">\n                <option value=\"Year2022\" :selected=\"variables.taxYear === 'Year2022'\">2022</option>\n                <option value=\"Year2021\" :selected=\"variables.taxYear === 'Year2021'\">2021</option>\n                <option value=\"Year2020\" :selected=\"variables.taxYear === 'Year2020'\">2020</option>\n                <option value=\"Year2019\" :selected=\"variables.taxYear === 'Year2019'\">2019</option>\n                <option value=\"Year2018\" :selected=\"variables.taxYear === 'Year2018'\">2018</option>\n            </select>\n        </div>\n    </div>\n\n\n    <div class=\"mt-2 flex flex-col w-full\" v-if=\"result\">\n        <div class=\"-my-2 overflow-x-auto w-full\">\n            <div class=\"inline-block min-w-full py-2 align-middle\">\n                <div class=\"overflow-hidden shadow border border-solid border-gray-300 md:rounded-lg\">\n\n                    <!-- HEADINGS -->\n                    <div class=\"grid grid-cols-4 lg:grid-cols-7 border-b border-solid border-gray-300\">\n                        <div class=\"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6\">Period</div>\n                        <div class=\"hide lg:block px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">Entries</div>\n                        <div class=\"hide lg:block col-span-2 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">Dates</div>\n                        <div class=\"hide lg:block px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">Cost</div>\n                        <div class=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">Pay Date</div>\n                        <div class=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">Last synced</div>\n                    </div>\n\n                    <LoadingList v-if=\"loading\" />\n\n                    <div class=\"grid grid-cols-7 border-b border-solid border-gray-200 py-4 px-3 text-center\" v-if=\"!loading && result.payruns.length === 0\">\n                        <div class=\"col-span-7\">There are currently no pay runs for this employer</div>\n                    </div>\n\n                    <!-- CONTENT -->\n                    <PayRunList :payrun-data=\"result.payruns\" />\n                </div>\n            </div>\n        </div>\n    </div>\n</template>","import PayRuns from '~/vue/payrun/PayRunList.vue'\nimport { createApp, h, provide } from 'vue'\nimport { createPinia } from 'pinia'\nimport { DefaultApolloClient } from '@vue/apollo-composable'\nimport { defaultClient } from '~/js/composables/useApolloClient'\n\n\nconst payruns = async () => {\n    console.log(\"yep\")\n    const payruns = createApp({\n        setup() {\n            provide(DefaultApolloClient, defaultClient)\n        },\n        render: () => h(PayRuns)\n    })\n    payruns.use(createPinia())\n    const root = payruns.mount('#payruns-container')\n\n    return root\n}\n\npayruns().then( () => {\n    console.log()\n})"],"names":["PayRuns"],"mappings":"i6BAGU,GAAc,OAAO,SAAS,KAAK,MAAM,KAAK,s9FCU9C,GAAY,EAAS,CACvB,QAAS,OAAO,SAAS,KAAK,MAAM,KAAK,MACzC,WAAY,OAAO,SAAS,KAAK,MAAM,KAAK,GAAG,MAG7C,CAAE,SAAQ,UAAS,WAAY,EACjC,EACA,EACA,CAAE,aAAc,MAGd,EAAQ,IAER,EAAgB,AAAC,GAAiB,IAEhC,CAAC,QACM,eAGL,GAAS,EAAQ,IAAI,GAAM,EAAG,YAAY,KAAK,CAAC,EAAG,IAAM,EAAI,SAC5D,GAAO,OAAS,EAAI,EAAO,GAAK,WAIrC,EAAa,AAAC,GAAyB,MAEnC,GAAU,GAAI,KAAI,OAAO,SAAS,MAClC,EAAO,EAAQ,SAAS,MAAM,OAC/B,QACG,SAAW,EAAK,KAAK,KAAO,IAAM,SACnC,QAAQ,UAAU,GAAI,GAAI,KAEvB,QAAU,mtECtCtB,GAAU,SAAY,SAChB,IAAI,YACN,GAAU,EAAU,CACtB,OAAQ,GACI,EAAqB,IAEjC,OAAQ,IAAM,EAAEA,eAEZ,IAAI,KACC,EAAQ,MAAM,uBAK/B,KAAU,KAAM,IAAM,SACV"}