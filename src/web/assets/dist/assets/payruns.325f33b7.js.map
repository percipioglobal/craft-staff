{"version":3,"file":"payruns.325f33b7.js","sources":["../../../../../buildchain/src/vue/molecules/listitems/listitem--payrun.vue","../../../../../buildchain/src/vue/payrun/PayRunList.vue","../../../../../buildchain/src/js/payruns.ts"],"sourcesContent":["<script setup lang=\"ts\">\n    import { format } from '~/js/composables/useCurrencyFormat'\n\n    const currentYear = window.location.href.split('/').pop()\n\n    const props = defineProps({\n        payrunData: Object,\n    })\n    \n</script>\n\n<template>\n  <a \n    v-for=\"payrun in payrunData\"\n    :key=\"payrun.id\"\n    :href=\"`/admin/staff-management/pay-runs/${payrun.employerId}/${currentYear}/${payrun.id}`\" \n    :title=\"`Go to pay run ${payrun.period}/${payrun.taxYear}`\" \n    class=\"grid grid-cols-4 lg:grid-cols-7 border-b border-solid border-gray-200 no-underline hover:bg-gray-200\" \n  >\n    <div class=\"flex items-center whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-indigo-800 sm:pl-6\">\n      <span\n        :class=\"[\n          'rounded-full w-5 h-5 fond-bold flex items-center justify-center mb-0',\n          payrun.state == 'Open' ? 'border-2 border-solid border-emrald-500 text-emerald-500': '',\n          payrun.state == 'Closed' ? 'border-2 border-solid border-green-500 text-white bg-emerald-500': '',\n          payrun.state == 'Finalised' ? 'border-2 border-solid border-green-500 text-white bg-emerald-500': ''\n        ]\"\n      >{{ payrun.period }}</span>\n    </div>\n    <div class=\"hide lg:flex lg:items-center whitespace-nowrap px-3 py-4 text-sm text-gray-500\">{{ payrun.employeeCount }}</div>\n    <div class=\"hide lg:flex lg:items-center col-span-2 whitespace-nowrap px-3 py-4 text-sm text-gray-500\">{{ payrun.startDate }} - {{ payrun.endDate }}</div>\n    <div class=\"hide lg:flex lg:items-center whitespace-nowrap px-3 py-4 text-sm text-gray-500\">Â£ {{ format(payrun.totals.totalCost) }}</div>\n    <div class=\"flex items-center whitespace-nowrap px-3 py-4 text-sm text-gray-500\">{{ payrun.paymentDate }}</div>\n    <div class=\"flex items-center whitespace-nowrap px-3 py-4 text-sm text-gray-500\">{{ payrun.dateSynced }}</div>\n  </a>\n</template>","<script setup lang=\"ts\">\n    import { reactive } from 'vue'\n\n    import { useQuery } from '@vue/apollo-composable'\n\n    import { fetchPayRuns } from '~/js/composables/useAxiosClient'\n    import { usePayRunStore } from '~/stores/payrun'\n    import { PAYRUNS } from '~/graphql/payrun.ts'\n\n    import PayRunList from '~/vue/molecules/listitems/listitem--payrun.vue'\n    import LoadingList from '~/vue/molecules/listitems/listitem--loading.vue'\n    import StatusSynced from '~/vue/molecules/status/status--synced.vue'\n\n    const variables = reactive({ \n        taxYear: window.location.href.split('/').pop(),\n        employerId: window.location.href.split('/').at(-2)\n    })\n\n    const { result, loading, refetch } = useQuery(\n        PAYRUNS, \n        variables, \n        { pollInterval: 5000 }\n    )\n\n    const store = usePayRunStore()\n\n    const getLatestSync = (payruns: any) => {\n\n        if (!payruns) {\n            return 'unknown'\n        }\n\n        const sorted = payruns.map(pr => pr.dateSynced).sort((a, b) => a < b)\n        return sorted.length > 0 ? sorted[0] : 'unknown'\n\n    }\n\n    const updateYear = (selectedYear: string) => {\n\n        const baseUrl = new URL(window.location.href)\n        const path = baseUrl.pathname.split('/')\n        path.pop()\n        baseUrl.pathname = path.join('/') + '/' + selectedYear\n        window.history.pushState({}, '', baseUrl)\n\n        variables.taxYear = selectedYear\n    }\n\n</script>\n\n<template>\n  <div\n    v-if=\"result\"\n    class=\"md:flex items-start\"\n  >\n    <div\n      class=\"flex-grow pr-4\"\n      style=\"margin-bottom:0\"\n    >\n      <div class=\"flex items-center\">\n        <a\n          href=\"/admin/staff-management/pay-runs\"\n          :title=\"`Back to ${result.payruns[0]?.employer}`\"\n          class=\"inline-flex no-underline items-center px-2.5 py-1.5 rounded-full text-sm text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n          style=\"margin-bottom:0\"\n        >&larr;</a>\n        <h1 class=\"ml-1 text-xl font-semibold text-gray-900\">\n          {{ result.payruns[0]?.employer }}\n        </h1>\n      </div>\n      <p class=\"mt-2 text-sm text-gray-700\">\n        The table below shows payrun overviews for {{ result.payruns[0]?.employer }}. If a payrun has recently been setup in Staffology but does not yet appear below, click the Fetch&nbsp;Pay&nbsp;Runs button to update.\n      </p>\n    </div>\n    <div\n      class=\"mt-4 md:mt-0 flex\"\n      style=\"margin-bottom:0\"\n    >\n      <StatusSynced :date=\"getLatestSync(result.payruns)\" />\n      <button \n        :disabled=\"store.loadingFetched\"\n        class=\"cursor-pointer inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 disabled:bg-indigo-400 disabled:cursor-not-allowed px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto\" \n        style=\"margin-bottom:0\" \n        @click=\"fetchPayRuns(variables?.employerId, variables?.taxYear)\"\n      >\n        <span>Refresh Pay Runs</span>\n        <svg\n          v-if=\"store.loadingFetched\"\n          class=\"animate-spin ml-1 h-3 w-3 text-white\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          style=\"margin-bottom:0\"\n        >\n          <circle\n            class=\"opacity-25\"\n            cx=\"12\"\n            cy=\"12\"\n            r=\"10\"\n            stroke=\"currentColor\"\n            stroke-width=\"4\"\n          />\n          <path\n            class=\"opacity-75\"\n            fill=\"currentColor\"\n            d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n          />\n        </svg>\n      </button>\n    </div>\n  </div>\n\n  <div\n    v-if=\"result\"\n    class=\"mt-8 ml-auto grid grid-cols-4\"\n  >\n    <div class=\"col-start-4 flex justify-end\">\n      <span class=\"mb-1 mr-2 font-bold\">Choose a payroll year:</span>\n      <select\n        class=\"py-1 px-1 rounded-md bg-gray-100 border-2 border-indigo-600 text-right\"\n        @change=\"updateYear($event?.target?.value)\"\n      >\n        <option\n          value=\"Year2022\"\n          :selected=\"variables.taxYear === 'Year2022'\"\n        >\n          2022\n        </option>\n        <option\n          value=\"Year2021\"\n          :selected=\"variables.taxYear === 'Year2021'\"\n        >\n          2021\n        </option>\n        <option\n          value=\"Year2020\"\n          :selected=\"variables.taxYear === 'Year2020'\"\n        >\n          2020\n        </option>\n        <option\n          value=\"Year2019\"\n          :selected=\"variables.taxYear === 'Year2019'\"\n        >\n          2019\n        </option>\n        <option\n          value=\"Year2018\"\n          :selected=\"variables.taxYear === 'Year2018'\"\n        >\n          2018\n        </option>\n      </select>\n    </div>\n  </div>\n\n\n  <div\n    v-if=\"result\"\n    class=\"mt-2 flex flex-col w-full\"\n  >\n    <div class=\"-my-2 overflow-x-auto w-full\">\n      <div class=\"inline-block min-w-full py-2 align-middle\">\n        <div class=\"overflow-hidden shadow border border-solid border-gray-300 md:rounded-lg\">\n          <!-- HEADINGS -->\n          <div class=\"grid grid-cols-4 lg:grid-cols-7 border-b border-solid border-gray-300\">\n            <div class=\"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6\">\n              Period\n            </div>\n            <div class=\"hide lg:block px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n              Entries\n            </div>\n            <div class=\"hide lg:block col-span-2 px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n              Dates\n            </div>\n            <div class=\"hide lg:block px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n              Cost\n            </div>\n            <div class=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n              Pay Date\n            </div>\n            <div class=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900\">\n              Last synced\n            </div>\n          </div>\n\n          <LoadingList v-if=\"loading\" />\n\n          <div\n            v-if=\"!loading && result.payruns.length === 0\"\n            class=\"grid grid-cols-7 border-b border-solid border-gray-200 py-4 px-3 text-center\"\n          >\n            <div class=\"col-span-7\">\n              There are currently no pay runs for this employer\n            </div>\n          </div>\n\n          <!-- CONTENT -->\n          <PayRunList :payrun-data=\"result.payruns\" />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>","import PayRuns from '~/vue/payrun/PayRunList.vue'\nimport { createApp, h, provide } from 'vue'\nimport { createPinia } from 'pinia'\nimport { DefaultApolloClient } from '@vue/apollo-composable'\nimport { defaultClient } from '~/js/composables/useApolloClient'\n\n\nconst payruns = async () => {\n    console.log(\"yep\")\n    const payruns = createApp({\n        setup() {\n            provide(DefaultApolloClient, defaultClient)\n        },\n        render: () => h(PayRuns)\n    })\n    payruns.use(createPinia())\n    const root = payruns.mount('#payruns-container')\n\n    return root\n}\n\npayruns().then( () => {\n    console.log()\n})"],"names":["PayRuns"],"mappings":"4+BAGI,KAAM,GAAc,OAAO,SAAS,KAAK,MAAM,GAAG,EAAE,k/FCUpD,KAAM,GAAY,EAAS,CACvB,QAAS,OAAO,SAAS,KAAK,MAAM,GAAG,EAAE,IAAI,EAC7C,WAAY,OAAO,SAAS,KAAK,MAAM,GAAG,EAAE,GAAG,EAAE,CAAA,CACpD,EAEK,CAAE,SAAQ,UAAS,WAAY,EACjC,EACA,EACA,CAAE,aAAc,GACpB,CAAA,EAEM,EAAQ,IAER,EAAgB,AAAC,GAAiB,CAEpC,GAAI,CAAC,EACM,MAAA,UAGX,KAAM,GAAS,EAAQ,IAAI,AAAA,GAAM,EAAG,UAAU,EAAE,KAAK,CAAC,EAAG,IAAM,EAAI,CAAC,EACpE,MAAO,GAAO,OAAS,EAAI,EAAO,GAAK,SAAA,EAIrC,EAAa,AAAC,GAAyB,CAEzC,KAAM,GAAU,GAAI,KAAI,OAAO,SAAS,IAAI,EACtC,EAAO,EAAQ,SAAS,MAAM,GAAG,EACvC,EAAK,IAAI,EACT,EAAQ,SAAW,EAAK,KAAK,GAAG,EAAI,IAAM,EAC1C,OAAO,QAAQ,UAAU,CAAC,EAAG,GAAI,CAAO,EAExC,EAAU,QAAU,CAAA,8qECtCtB,GAAU,SAAY,CACxB,QAAQ,IAAI,KAAK,EACjB,KAAM,GAAU,EAAU,CACtB,OAAQ,CACJ,EAAQ,EAAqB,CAAa,CAC9C,EACA,OAAQ,IAAM,EAAEA,EAAO,CAAA,CAC1B,EACO,SAAA,IAAI,GAAa,EACZ,EAAQ,MAAM,oBAAoB,CAGnD,EAEA,GAAQ,EAAE,KAAM,IAAM,CAClB,QAAQ,IAAI,CAChB,CAAC"}