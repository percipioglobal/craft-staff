{"version":3,"file":"useApolloClient.3973916d.js","sources":["../../../../../buildchain/plugin-vue:export-helper","../../../../../buildchain/src/stores/payrun.ts","../../../../../buildchain/src/js/composables/useAxiosClient.ts","../../../../../buildchain/src/js/composables/useApolloClient.ts"],"sourcesContent":["\nexport default (sfc, props) => {\n  const target = sfc.__vccOpts || sfc;\n  for (const [key, val] of props) {\n    target[key] = val;\n  }\n  return target;\n}\n","import { defineStore } from 'pinia'\n\nexport const usePayRunStore = defineStore('payrun', {\n    state: () => ({\n        queue: 0,\n        fetching: false,\n        logs: []\n    })\n})","import axios from 'axios'\nimport { usePayRunStore } from '~/stores/payrun'\n\nconst ENDPOINT = window.api.cpUrl ?? 'https://localhost:8003'\n\n\nexport const fetchPayRuns = (employerId: string, taxYear: string) => {\n\n    const store = usePayRunStore()\n    store.loadingFetched = true\n\n    const url = taxYear ? `${ENDPOINT}/staff-management/pay-runs/fetch-pay-runs/${employerId}/${taxYear}` : `${ENDPOINT}/staff-management/pay-runs/fetch-pay-runs/${employerId}`\n\n    axios({\n        method: 'get',\n        url: url,\n    })\n    .then(() => {\n        store.loadingFetched = false\n    })\n\n}\n\nexport const fetchPayRun = (payRunId: string) => {\n\n    const store = usePayRunStore()\n    store.loadingFetched = true\n\n    axios({\n        method: 'get',\n        url: `${ENDPOINT}/staff-management/pay-runs/fetch-pay-run/${payRunId}`,\n    })\n    .then(() => {\n        store.loadingFetched = false\n    })\n\n}\n\nexport const getQueue = () => {\n\n    const store = usePayRunStore()\n\n    axios({\n        method: 'get',\n        url: `${ENDPOINT}/staff-management/pay-runs/queue`,\n    })\n    .then((response) => {\n        store.queue = response?.data?.total ? response.data.total : 0\n    })\n\n}\n\nexport const getPayRunLogs = (payRunId: string) => {\n\n    const store = usePayRunStore()\n\n    axios({\n        method: 'get',\n        url: `${ENDPOINT}/staff-management/pay-runs/get-logs/${payRunId}`,\n    })\n        .then((response) => {\n            store.logs = response?.data?.logs ? response.data.logs : []\n            // store.loadingFetched = false\n        })\n\n}\n\nexport const getToken = async (): Promise<string|null> => {\n\n    const token = {\n        value: null,\n    }\n\n    await axios({\n        method: 'get',\n        url: `${ENDPOINT}/staff-management/settings/get-gql-token`,\n    })\n    .then( (response) => {\n        token.value = response?.data?.token ? response.data.token : null\n    })\n\n    return token.value || null\n\n}","import { ApolloClient, from, InMemoryCache, HttpLink } from '@apollo/client/core'\nimport { onError } from '@apollo/client/link/error'\nimport { setContext } from '@apollo/client/link/context'\nimport { getToken } from '~/js/composables/useAxiosClient'\n\nconst ENDPOINT = window.api.baseUrl ?? 'https://localhost:8003/'\n\n// HTTP connection to the API\nconst httpLink = new HttpLink({\n    uri: `${ENDPOINT}api`,\n    credentials: 'include'\n})\n\nconst authLink = setContext(async (_, { headers }) => {\n    // get the authentication token from the store, if it's null fetch it through axios\n    const token = await getToken()\n\n    //const token = 'SgmAAuUYsFE0_GKOIo7deUOuZWj0yttv'\n    return {\n        headers: {\n            ...headers,\n            authorization: `Bearer ${token}`\n        }\n    }\n})\n\nexport const defaultClient = new ApolloClient({\n    cache: new InMemoryCache(),\n    link: from([ authLink, httpLink ])\n})"],"names":["ENDPOINT"],"mappings":"qhBACA,MAAe,CAAC,EAAK,IAAU,CAC7B,KAAM,GAAS,EAAI,WAAa,EAChC,SAAW,CAAC,EAAK,IAAQ,GACvB,EAAO,GAAO,EAEhB,MAAO,4nBCJI,GAAiB,EAAY,SAAU,CAChD,MAAO,MACH,MAAO,EACP,SAAU,GACV,KAAM,aCHd,KAAMA,GAAW,UAAO,IAAI,QAAX,OAAoB,yBAGxB,EAAe,CAAC,EAAoB,IAAoB,MAE3D,GAAQ,MACR,eAAiB,QAEjB,GAAM,EAAU,GAAGA,8CAAqD,KAAc,IAAY,GAAGA,8CAAqD,MAE1J,CACF,OAAQ,MACR,QAEH,KAAK,IAAM,GACF,eAAiB,MAKlB,EAAc,AAAC,GAAqB,MAEvC,GAAQ,MACR,eAAiB,KAEjB,CACF,OAAQ,MACR,IAAK,GAAGA,6CAAoD,MAE/D,KAAK,IAAM,GACF,eAAiB,MAmBlB,EAAgB,AAAC,GAAqB,MAEzC,GAAQ,MAER,CACF,OAAQ,MACR,IAAK,GAAGA,wCAA+C,MAEtD,KAAK,AAAC,GAAa,SACV,KAAO,qBAAU,OAAV,cAAgB,MAAO,EAAS,KAAK,KAAO,MAMxD,EAAW,SAAkC,MAEhD,GAAQ,CACV,MAAO,kBAGL,GAAM,CACR,OAAQ,MACR,IAAK,GAAGA,8CAEX,KAAM,AAAC,GAAa,SACX,MAAQ,qBAAU,OAAV,cAAgB,OAAQ,EAAS,KAAK,MAAQ,OAGzD,EAAM,OAAS,YC5E1B,KAAM,GAAW,UAAO,IAAI,UAAX,OAAsB,0BAGjC,EAAW,GAAI,GAAS,CAC1B,IAAK,GAAG,OACR,YAAa,YAGX,EAAW,EAAW,MAAO,EAAG,CAAE,aAAc,MAE5C,GAAQ,KAAM,WAGb,CACH,QAAS,OACF,GADE,CAEL,cAAe,UAAU,SAKxB,EAAgB,GAAI,GAAa,CAC1C,MAAO,GAAI,GACX,KAAM,EAAK,CAAE,EAAU"}